# 統合テスト



## 初期状態

- DBには `users` テーブルが存在しない状態にする
- Discordのアカウントを2つ用意する
- 環境変数 `RUN_ENVIRONMENT` に `development` を指定する



## テストフロー



### ユーザー登録

| ステージ | タスク | Discordアカウント | アクション                      | 期待される結果                                               | テスト対象の機能                                 |
| -------- | ------ | ----------------- | ------------------------------- | ------------------------------------------------------------ | ------------------------------------------------ |
| 0        | 0      | ユーザー1         | `hello` と送信する              | botから、ユーザー1が生きていることを褒めるメッセージが送信される | 自動ユーザー登録<br />「生きててえらい」ボーナス |
|          | 1      | ユーザー1         | `!erai me` と送信する           | botから、ユーザー1の情報が送信される<br />えらいポイントが1である<br />「めっちゃえらい」の残り回数が3である<br />えらいボーナスの残りカウントが5である<br />えらいボーナスの本日カウントが0である<br />カスペナルティの残りカウントが5である<br />カスペナルティの本日カウントが0である<br />GitHub IDが未登録である | ユーザー情報の取得                               |
|          | 2      | ユーザー1         | botに対するメンションを送信する | botから、ヘルプがDMで送信される                              | メンションによるヘルプの表示                     |
|          | 3      | ユーザー1         | `!erai help` と送信する         | botから、ヘルプがDMで送信される                              | コマンドによるヘルプの表示                       |



### 自分へのリアクション送信・送信解除

| ステージ | タスク | Discordアカウント | アクション                                                   | 期待される結果                                               | テスト対象の機能   |
| -------- | ------ | ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------ |
| 0        | 0      | ユーザー1         | ユーザー1のメッセージに対して `:clap:` のリアクションを付与する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />すべての情報に変化がない | ユーザー情報の取得 |
| 1        | 0      | ユーザー1         | ユーザー1のメッセージに対して付与された `:clap:` のリアクションを削除する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />すべての情報に変化がない | ユーザー情報の取得 |
| 2        | 0      | ユーザー1         | ユーザー1のメッセージに対して `:poop:` のリアクションを付与する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />すべての情報に変化がない | ユーザー情報の取得 |
| 3        | 0      | ユーザー1         | ユーザー1のメッセージに対して付与された `:poop:` のリアクションを削除する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />すべての情報に変化がない | ユーザー情報の取得 |
| 4        | 0      | ユーザー1         | ユーザー1のメッセージに対して付与された `:raised_hands:` のリアクションを削除する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />すべての情報に変化がない | ユーザー情報の取得 |
| 5        | 0      | ユーザー1         | ユーザー1のメッセージに対して `:raised_hands:` のリアクションを付与する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />すべての情報に変化がない | ユーザー情報の取得 |



### 他人へのリアクション送信・送信解除

| ステージ | タスク | Discordアカウント | アクション                                                   | 期待される結果                                               | テスト対象の機能   |
| -------- | ------ | ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------ |
| 0        | 0      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2が生きていることを褒めるメッセージが送信される<br />botから、ユーザー2の情報が送信される<br />えらいポイントが1である<br />「めっちゃえらい」の残り回数が3である<br />えらいボーナスの残りカウントが5である<br />えらいボーナスの本日カウントが0である<br />カスペナルティの残りカウントが5である<br />カスペナルティの本日カウントが0である<br />GitHub IDが未登録である |                    |
| 1        | 0      | ユーザー2         | ユーザー1のメッセージに対して `:clap:` のリアクションを付与する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />えらいポイントが2になる |                    |
|          | 2      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2の情報が送信される<br />えらいボーナスの残りカウントが4になる<br />えらいボーナスの本日カウントが1になる | ユーザー情報の取得 |
| 2        | 0      | ユーザー2         | ユーザー1のメッセージに対しての `:clap:` のリアクションを削除する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />えらいポイントが1になる |                    |
|          | 2      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2の情報が送信される<br />えらいボーナスの残りカウントが5になる<br />えらいボーナスの本日カウントが0になる |                    |
| 3        | 0      | ユーザー2         | ユーザー1のメッセージに対して `:poop:` のリアクションを付与する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />えらいポイントが0になる |                    |
|          | 2      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2の情報が送信される<br />カスペナルティの残りカウントが4になる<br />カスペナルティの本日カウントが1になる | ユーザー情報の取得 |
| 4        | 0      | ユーザー2         | ユーザー1のメッセージに対しての `:poop:` のリアクションを削除する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />えらいポイントが1になる |                    |
|          | 2      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2の情報が送信される<br />カスペナルティの残りカウントが5になる<br />カスペナルティの本日カウントが0になる |                    |
| 5        | 0      | ユーザー2         | ユーザー1のメッセージに対して `:raised_hands:` のリアクションを付与する | botから、ユーザー2がユーザー1に「めっちゃえらい」を送信した旨のメッセージが送信される<br />botから、ユーザー1を褒めるメッセージが送信される |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />えらいポイントが4になる |                    |
|          | 2      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2の情報が送信される<br />「めっちゃえらい」の残り回数が2になる | ユーザー情報の取得 |
| 6        | 0      | ユーザー2         | ユーザー1のメッセージに対しての `:raised_hands:` のリアクションを削除する | 何も起きない                                                 |                    |
|          | 1      | ユーザー1         | `!erai me` と送信する                                        | botから、ユーザー1の情報が送信される<br />えらいポイントが1になる |                    |
|          | 2      | ユーザー2         | `!erai me` と送信する                                        | botから、ユーザー2の情報が送信される<br />「めっちゃえらい」の残り回数が3になる |                    |



### ランキングの表示



